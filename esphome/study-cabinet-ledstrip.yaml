substitutions:
  device_name: "Study Cabinet Ledstrip"

esphome:
  name: "study-cabinet-ledstrip"
  on_boot:
    priority: -100  # Ensures this runs after most other things have initialized
    then:
      - light.turn_on:
          id: ledstrip
          effect: "Rainbow Swirl"
      - delay: 5s  # Let the rainbow show run for 2 seconds
      - light.turn_off:
          id: ledstrip

esp32:
  board: nodemcu-32s

packages:
  wifi: !include /config/esphome/common/wifi.yaml
  network_diagnostics: !include /config/esphome/common/network_diagnostics.yaml
  base_config: !include /config/esphome/common/base_config.yaml

e131:
  method: unicast

status_led:
  pin: GPIO2

light:
  - platform: esp32_rmt_led_strip
    id: ledstrip
    rgb_order: GRB
    chipset: SK6812
    is_rgbw: true
    pin: GPIO27
    num_leds: 154
    gamma_correct: 2.0
    name: "Study Cabinet A-RGB LEDstrip"
    effects:
      - e131:
          universe: 1
          channels: RGB
      - addressable_rainbow:
          name: Rainbow Swirl
          speed: 10
          width: 154
      - addressable_color_wipe:
          name: "Colorful Wipe"
          colors:
            - red: 100%
              green: 0%
              blue: 0%
              white: 0%
              num_leds: 154
            - red: 0%
              green: 100%
              blue: 0%
              white: 0%
              num_leds: 154
            - red: 0%
              green: 0%
              blue: 100%
              white: 0%
              num_leds: 154
          add_led_interval: 100ms
      - addressable_scan:
          name: "Ping Pong"
          move_interval: 100ms
          scan_width: 10
      - addressable_lambda:
          name: "Simple Color Wipe"
          update_interval: 100ms
          lambda: |-
            using esphome::Color;

            for (int i = it.size() - 1; i > 0; i--) {
              it[i] = it[i - 1].get();
            }

            const uint32_t r = random_uint32();
            const uint8_t red   = (r >>  0) & 0xFF;
            const uint8_t green = (r >>  8) & 0xFF;
            const uint8_t blue  = (r >> 16) & 0xFF;

            // Color(red, green, blue, white) exists and is the right type for addressable LEDs.
            it[0] = Color(red, green, blue, 0);
      - addressable_lambda:
          name: "Random Sparkle"
          update_interval: 50ms
          lambda: |-
            using esphome::Color;

            it.all().fade_to_black(50);

            if ((random_uint32() % 10) > 8) {
              const uint32_t r = random_uint32();
              const uint8_t red   = (r >>  0) & 0xFF;
              const uint8_t green = (r >>  8) & 0xFF;
              const uint8_t blue  = (r >> 16) & 0xFF;

              it[random_uint32() % it.size()] = Color(red, green, blue, 0);
            }
      - addressable_lambda:
          name: "Gradient Shift"
          update_interval: 50ms
          lambda: |-
            using esphome::light::ESPHSVColor;

            it.shift_right(1);

            static uint16_t start_index = 0;
            start_index = (start_index + 1) % it.size();

            // ESPHSVColor takes 0..255 for hue/sat/val (uint8_t), not degrees/floats.
            const uint8_t hue = static_cast<uint8_t>((start_index * 255u) / it.size());

            // You can assign HSV directly; ESPColorView has operator=(ESPHSVColor)
            it[0] = ESPHSVColor(hue, 255, 255);
